{ MongoClient, ServerApiVersion } from mongodb
// @ts-expect-error - no types
{ register } from on-exit-leak-free

{ authInstance } from ../auth.civet

export createClient := ->
  { uri } := await authInstance.readDbCredentials()
  client := new MongoClient uri,
    serverApi:
      version: ServerApiVersion.v1
      strict: true
      deprecationErrors: true
  register client, ->
    client.close true
  client
