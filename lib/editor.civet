{ spawnSync } from node:child_process

{ EDITOR, TMP_FILE_NAME } from ./const.civet

export openOnEditor := (initialBuffer = '') ->
  await Bun.write TMP_FILE_NAME, initialBuffer
  editor := spawnSync EDITOR, ['-n', TMP_FILE_NAME], stdio: 'inherit'
  if editor.status
    throw new Error 'Failed to open editor'
  Bun.file TMP_FILE_NAME
    |> .text()
    |> await
